rl -s learning on # Reinforcement Llearning

sp {propose*initialize-escape
    (state <s> ^superstate nil 
              -^name)
-->
    (<s> ^operator <o> +)
    (<o> ^name initialize-escape)
    #(write |Proposed!|)
}

sp {apply*initialize-escape
    (state <s> ^operator <op>)
    (<op> ^name initialize-escape)
-->
    (<s> ^name escape
         ^height 1.5
         ^location start
         ^objects <el> <tw> <st> <tr1> <tr2>
         ^direction <d1> <d2> <d3> <d4> <d5> <d6>
         ^escaped no)
    
    #(<d0> ^name start_loc ^item nil ^reward -1000)
    (<d1> ^name window_loc ^item <wn> ^reward -0.5)
    (<d2> ^name elastic_loc ^item <el> ^reward -10)
    (<d3> ^name stones_loc ^item <st> ^reward -10)
    (<d4> ^name twig_loc ^item <tw> ^reward -10)
    (<d5> ^name trunk1_loc ^item <tr1> ^reward -10)
    (<d6> ^name trunk2_loc ^item <tr2> ^reward -10)

    (<el> ^name elastic ^available yes) 
    (<tw> ^name twig ^available yes) # rametto
    (<st> ^name stones ^available yes) 
    (<tr1> ^name trunk_1 ^available yes ^height 1.0)   
    (<tr2> ^name trunk_2 ^available yes ^height 1.0)
    (<wn> ^name window ^height 3.5)
    
    (write |Initialized!|)
}

sp {htcompare*move*take 
   (state <s>  ^name escape) 
   (<s> ^operator <op-move> +) 
   (<s> ^operator <op-take> +) 
   (<op-move> ^name move)
   (<op-take> ^name take) 
-->
   (<s> ^operator <op-take> > <op-move>)
} 

### Propose & Apply ### 
sp {propose*move
   (state <s> ^name escape
              ^direction <d> 
              ^location <from>)

   (<d> ^name <dir>)
   -(<d> ^name <from>)
-->
   (<s> ^operator <op> +) 
   (<op> ^name move 
         ^dir <dir>)
}

sp {apply*move
   (state <s> ^operator <op> 
              ^location <loc>)
   (<op> ^name move 
         ^dir <dir>)
-->
   (<s> ^location <loc> - <dir>) 
   (write (crlf) |Moved from: |<loc> | to: | <dir>)
}

sp {propose*take
   (state <s> ^name escape
              ^location <loc>
              ^direction <dir>)
   
   (<dir> ^name <loc>
          ^item <item>)
   
   (<item> ^name <item_name> ^available yes)
   -(<item> ^name window)
-->
   (<s> ^operator <op> +)
   (<op> ^name take
         ^item <item>
         ^item_name <item_name>)
}

sp {apply*take
   (state <s> ^name escape
              ^operator <op>
              ^objects <obj>)
   (<op> ^name take 
         ^item <item>
         ^item_name <item_name>)  
   (<obj> ^name <item_name>)        
-->
   (<obj> ^available yes - no +)
   (write (crlf) |Taken item:| <item_name>)
   (<s> ^operator <op> -)
}




### RL Rules
sp {rl*window
   (state <s> ^name escape 
              ^operator <op> +) 
   (<op> ^name move 
         ^dir window_loc) 
-->
   (<s> ^operator <op> = 0)
}

sp {rl*elastic
   (state <s> ^name escape 
              ^operator <op> +) 
   (<op> ^name move 
         ^dir elastic_loc) 
-->
   (<s> ^operator <op> = 0)
}

sp {rl*stones
   (state <s> ^name escape 
              ^operator <op> +) 
   (<op> ^name move 
         ^dir stones_loc) 
-->
   (<s> ^operator <op> = 0)
}
sp {rl*twig
   (state <s> ^name escape 
              ^operator <op> +) 
   (<op> ^name move 
         ^dir twig_loc) 
-->
   (<s> ^operator <op> = 0)
}
sp {rl*trunk1
   (state <s> ^name escape 
              ^operator <op> +) 
   (<op> ^name move 
         ^dir trunk1_loc) 
-->
   (<s> ^operator <op> = 0)
}
sp {rl*trunk2
   (state <s> ^name escape 
              ^operator <op> +) 
   (<op> ^name move 
         ^dir trunk2_loc) 
-->
   (<s> ^operator <op> = 0)
}

sp {elaborate*reward 
   (state <s> ^name escape
              ^reward-link <r> #reward-link
              ^location <d-name> 
              ^direction <dir>) 
   (<dir> ^name <d-name> ^reward <d-reward>) 
-->
   (<r> ^reward <rr>) 
   (<rr> ^value <d-reward>)
}

sp {elaborate*done
   (state <s> ^name escape
              ^location window_loc
              ^objects <ob1> <ob2> <ob3> <ob4> <ob5>)
   (<ob1> ^name elastic ^available no)
   (<ob2> ^name twig ^available no)
   (<ob3> ^name stones ^available no)
   (<ob4> ^name trunk_2 ^available no)
   (<ob5> ^name trunk_1 ^available no)
-->
   (write (crlf) |Hai preso tutti gli oggetti! |)
   (halt)
}